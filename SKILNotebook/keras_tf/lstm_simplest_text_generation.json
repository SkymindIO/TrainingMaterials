{"paragraphs":[{"text":"%md\n##Simplest Non-stateful LSTM Example\n**Predict next character from the sequence*\n**'*ABCDEFGHIJKLMNOPQRSTUVWXYZ'**\n\nTask:\nFine-tune the model to achieve better performance","user":"admin","dateUpdated":"2018-10-25T08:25:14+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Simplest Non-stateful LSTM Example</h2>\n<p><strong>Predict next character from the sequence<em>\n<br  /></em><em>'</em>ABCDEFGHIJKLMNOPQRSTUVWXYZ'</strong></p>\n<p>Task:\n<br  />Fine-tune the model to achieve better performance</p>\n"}]},"apps":[],"jobName":"paragraph_1540455246932_1140852123","id":"20181025-081406_1409020482","dateCreated":"2018-10-25T08:14:06+0000","dateStarted":"2018-10-25T08:25:14+0000","dateFinished":"2018-10-25T08:25:14+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:107"},{"title":"Python imports","text":"%pyspark\n\nimport numpy\nimport tensorflow as tf\n\nfrom keras.callbacks import LambdaCallback\nfrom keras.utils import np_utils\nfrom keras.models import Sequential\nfrom keras.layers import Dense, LSTM\n\n#fix random seed for reproducibility\nseed = 7 \nepoch = 15\nnumpy.random.seed(seed)\ntf.set_random_seed(seed)","user":"admin","dateUpdated":"2018-10-25T08:24:19+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1540454713904_64358638","id":"20181004-073948_1408818626","dateCreated":"2018-10-25T08:05:13+0000","dateStarted":"2018-10-25T08:24:19+0000","dateFinished":"2018-10-25T08:24:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:108"},{"title":"Python SKIL Context","text":"%pyspark\n\nimport skil\n\nskilContext = skil.SkilContext(sc)\n","user":"admin","dateUpdated":"2018-10-25T08:24:19+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1540454713909_62434894","id":"20181004-073948_460107346","dateCreated":"2018-10-25T08:05:13+0000","dateStarted":"2018-10-25T08:24:19+0000","dateFinished":"2018-10-25T08:24:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:109"},{"text":"%pyspark\n\nrawstr = '*ABCDEFGHIJKLMNOPQRSTUVWXYZ'#\"*This example trains a LSTM. Look for lab steps below. Uncomment to proceed.\";\ninputstr = rawstr.lower()\n\n#to eliminate redundant character\nuniquechars = sorted(list(set(inputstr)))\n\n#create mapping for characters\n#look up table->character : index\nlut = dict((c, i) for i, c in enumerate(uniquechars))\n#reverse look up table->index : character\nrut = dict((i, c) for i, c in enumerate(uniquechars))\n\n\n\n","user":"admin","dateUpdated":"2018-10-25T08:24:19+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1540454713909_62434894","id":"20181004-075030_1608306738","dateCreated":"2018-10-25T08:05:13+0000","dateStarted":"2018-10-25T08:24:19+0000","dateFinished":"2018-10-25T08:24:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:110"},{"text":"%pyspark\n\n'''\nNative LSTM CallBack: One to one mapping\n'''\ndef simplestCallBack(epoch, _):\n\n    print('Epoch %d' % epoch)\n\n    prediction = ''\n    charnow = inputstr[0]\n\n    for i in range(1, len(inputstr)):\n        buffer = numpy.zeros((1, 1, len(uniquechars)), dtype = numpy.bool)\n        buffer[0, 0, lut[charnow]] = 1\n        predictClass = model.predict_classes(buffer)\n        charnow = rut[predictClass[0]]\n        prediction = prediction + charnow\n    print('Prediction:', prediction)\n\n","user":"admin","dateUpdated":"2018-10-25T08:24:19+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"},"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1540454713909_62434894","id":"20181004-075146_1134469819","dateCreated":"2018-10-25T08:05:13+0000","dateStarted":"2018-10-25T08:24:19+0000","dateFinished":"2018-10-25T08:24:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:111"},{"text":"%pyspark\n\n#input data dimension data samples, time steps, features)\n#output data = (data samples, features)\n\ninputdata = numpy.zeros((len(inputstr), 1, len(uniquechars)), dtype = numpy.bool)\nlabels = []\n\nprint('One to one mapping')\nfor i in range(0, len(inputstr) - 1):\n    inputdata[i, 0, lut[inputstr[i]]] = 1\n    labels.append(lut[inputstr[i + 1]])\n    print(inputstr[i], '->', inputstr[i + 1])\n    \n#next character of last one pointing to the [0]\nlabels.append(lut[inputstr[0]])\n\n#last character of input\nlastindex = len(inputstr) - 1;\ninputdata[lastindex, 0, lut[inputstr[lastindex]]] = 1\n\n#create one hot labels for classification\nonehotlabels = np_utils.to_categorical(labels)","user":"admin","dateUpdated":"2018-10-25T08:24:19+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"One to one mapping\n('*', '->', 'a')\n('a', '->', 'b')\n('b', '->', 'c')\n('c', '->', 'd')\n('d', '->', 'e')\n('e', '->', 'f')\n('f', '->', 'g')\n('g', '->', 'h')\n('h', '->', 'i')\n('i', '->', 'j')\n('j', '->', 'k')\n('k', '->', 'l')\n('l', '->', 'm')\n('m', '->', 'n')\n('n', '->', 'o')\n('o', '->', 'p')\n('p', '->', 'q')\n('q', '->', 'r')\n('r', '->', 's')\n('s', '->', 't')\n('t', '->', 'u')\n('u', '->', 'v')\n('v', '->', 'w')\n('w', '->', 'x')\n('x', '->', 'y')\n('y', '->', 'z')\n"}]},"apps":[],"jobName":"paragraph_1540454713909_62434894","id":"20181004-075434_363013372","dateCreated":"2018-10-25T08:05:13+0000","dateStarted":"2018-10-25T08:24:19+0000","dateFinished":"2018-10-25T08:24:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:112"},{"text":"%pyspark\n\n#input shape for first layer is (timesteps, features)\n#output in this case is number of unique characters\nmodel = Sequential()\nmodel.add(LSTM(units = 100, input_shape = (inputdata.shape[1], inputdata.shape[2])))\nmodel.add(Dense(units = onehotlabels.shape[1], activation = 'softmax'))\nmodel.compile(optimizer = 'rmsprop', loss = 'categorical_crossentropy', metrics = ['accuracy'])\n\ncallback = LambdaCallback( on_epoch_end = simplestCallBack)\nmodel.fit(inputdata, onehotlabels, epochs = epoch, verbose = 2, callbacks = [callback])\n    ","user":"admin","dateUpdated":"2018-10-25T08:24:19+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Epoch 1/15\n - 1s - loss: 3.2946 - acc: 0.0370\nEpoch 0\n('Prediction:', 'nrpqdjjjjjjjjjjjjjjjjjjjjj')\nEpoch 2/15\n - 0s - loss: 3.2811 - acc: 0.1111\nEpoch 1\n('Prediction:', 'nrsbctjjjjjjjjjjjjjjjjjjjj')\nEpoch 3/15\n - 0s - loss: 3.2713 - acc: 0.2963\nEpoch 2\n('Prediction:', 'nrsbctuv*nrsbctuv*nrsbctuv')\nEpoch 4/15\n - 0s - loss: 3.2630 - acc: 0.3704\nEpoch 3\n('Prediction:', 'nrstuvwxvwxvwxvwxvwxvwxvwx')\nEpoch 5/15\n - 0s - loss: 3.2556 - acc: 0.5556\nEpoch 4\n('Prediction:', 'nrstuvwxvwxvwxvwxvwxvwxvwx')\nEpoch 6/15\n - 0s - loss: 3.2487 - acc: 0.6667\nEpoch 5\n('Prediction:', 'nrstuvwxvwxvwxvwxvwxvwxvwx')\nEpoch 7/15\n - 0s - loss: 3.2422 - acc: 0.7778\nEpoch 6\n('Prediction:', 'abcdefgzrstuvwxvwxvwxvwxvw')\nEpoch 8/15\n - 0s - loss: 3.2359 - acc: 0.8148\nEpoch 7\n('Prediction:', 'abcdefghijklmnrstuvwxvwxvw')\nEpoch 9/15\n - 0s - loss: 3.2299 - acc: 0.8519\nEpoch 8\n('Prediction:', 'abcdefghijklmnrstuvwxvwxvw')\nEpoch 10/15\n - 0s - loss: 3.2240 - acc: 0.8889\nEpoch 9\n('Prediction:', 'abcdefghijklmnrstuvwxyefgh')\nEpoch 11/15\n - 0s - loss: 3.2183 - acc: 0.9259\nEpoch 10\n('Prediction:', 'abcdefghijklmnrstuvwxyefgh')\nEpoch 12/15\n - 0s - loss: 3.2126 - acc: 0.9259\nEpoch 11\n('Prediction:', 'abcdefghijklmnrstuvwxyefgh')\nEpoch 13/15\n - 0s - loss: 3.2071 - acc: 0.9259\nEpoch 12\n('Prediction:', 'abcdefghijklmnrstuvwxyefgh')\nEpoch 14/15\n - 0s - loss: 3.2015 - acc: 0.9259\nEpoch 13\n('Prediction:', 'abcdefghijklmnrstuvwxyefgh')\nEpoch 15/15\n - 0s - loss: 3.1960 - acc: 0.9259\nEpoch 14\n('Prediction:', 'abcdefghijklmnrstuvwxyefgh')\n<keras.callbacks.History object at 0x7faafe1a2b90>\n"}]},"apps":[],"jobName":"paragraph_1540454713910_63589140","id":"20181004-075338_1305822863","dateCreated":"2018-10-25T08:05:13+0000","dateStarted":"2018-10-25T08:24:19+0000","dateFinished":"2018-10-25T08:24:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:113"},{"title":"Python model saving.","text":"%pyspark\n\n\nmodel_id = skilContext.addModelToExperiment(z, model, \"SimplestLSTM\")\nskilContext.addEvaluationToModel(z, model_id, model, inputdata, onehotlabels, \"Keras mlp \" + str(epoch) + \" epochs\")\n","user":"admin","dateUpdated":"2018-10-25T08:24:19+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"u'39485a83-c86a-4dc8-ab0c-788a984f25a6'\n"}]},"apps":[],"jobName":"paragraph_1540454713911_63204391","id":"20181004-073948_224265690","dateCreated":"2018-10-25T08:05:13+0000","dateStarted":"2018-10-25T08:24:20+0000","dateFinished":"2018-10-25T08:24:25+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:114"},{"text":"%pyspark\n","user":"admin","dateUpdated":"2018-10-25T08:24:19+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1540454713911_63204391","id":"20181004-073948_408805246","dateCreated":"2018-10-25T08:05:13+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:115"}],"name":"/SimplestLSTM","id":"2DTC25K7M","angularObjects":{"2DUEGVJHV:existing_process":[],"2DUV6FQ57:existing_process":[],"2DUY5ZPD1:existing_process":[],"2DUEH9MQ1:existing_process":[],"2DVSBVTRW:existing_process":[],"2DTQQ28BY:existing_process":[],"2DVH2TXYZ:existing_process":[],"2DU7N5KJK:existing_process":[],"2DV4BQJY9:existing_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}