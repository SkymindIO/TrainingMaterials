{"paragraphs":[{"title":"Python imports","text":"%pyspark\n\nimport numpy\nimport tensorflow\nfrom keras.utils import np_utils\nfrom keras.models import Sequential\nfrom keras.layers import Dense, LSTM\n","user":"admin","dateUpdated":"2018-10-04T14:02:26+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1538658435459_-1251384416","id":"20181004-130715_402226220","dateCreated":"2018-10-04T13:07:15+0000","dateStarted":"2018-10-04T14:02:26+0000","dateFinished":"2018-10-04T14:02:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:205"},{"title":"Python SKIL Context","text":"%pyspark\n\nimport skil\n\nskilContext = skil.SkilContext(sc)\n","user":"admin","dateUpdated":"2018-10-04T14:02:26+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1538658435459_-1251384416","id":"20181004-130715_657142092","dateCreated":"2018-10-04T13:07:15+0000","dateStarted":"2018-10-04T14:02:27+0000","dateFinished":"2018-10-04T14:02:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:206"},{"text":"%pyspark\n#fix random seed for reproducibility\nseed = 7\nnumpy.random.seed(seed)\ntensorflow.set_random_seed(seed)","user":"admin","dateUpdated":"2018-10-04T14:02:27+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1538658651434_-300145573","id":"20181004-131051_1626730516","dateCreated":"2018-10-04T13:10:51+0000","dateStarted":"2018-10-04T14:02:27+0000","dateFinished":"2018-10-04T14:02:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:207"},{"text":"%pyspark\n\nrawstr = '*This example trains a LSTM. Look for lab steps below. Uncomment to proceed.'#'*ABCDEFGHIJKLMNOPQRSTUVWXYZ'\ninputstr = rawstr.lower()\n\n#to eliminate redundant character\nuniquechars = sorted(list(set(inputstr)))\n\n#create mapping for characters\n#look up table->character : index\nlut = dict((c, i) for i, c in enumerate(uniquechars))\n#reverse look up table->index : character\nrut = dict((i, c) for i, c in enumerate(uniquechars))\n\nepoch = 1\n","user":"admin","dateUpdated":"2018-10-04T14:02:27+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1538658739655_858823739","id":"20181004-131219_1265184387","dateCreated":"2018-10-04T13:12:19+0000","dateStarted":"2018-10-04T14:02:27+0000","dateFinished":"2018-10-04T14:02:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:208"},{"text":"%pyspark\n\n'''\nStateful LSTM CheckOutput\n'''\ndef callBack():\n\n    prediction = ''\n    charnow = inputstr[0]\n\n    for i in range(1, len(inputstr)):\n        buffer = numpy.zeros((1, 1, len(uniquechars)), dtype = numpy.bool)\n        buffer[0, 0, lut[charnow]] = 1\n        predictClass = model.predict_classes(buffer)\n        charnow = rut[predictClass[0]]\n        prediction = prediction + charnow\n    print('Prediction:', prediction)\n\n    model.reset_states()\n","user":"admin","dateUpdated":"2018-10-04T14:02:27+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1538658813276_1400473569","id":"20181004-131333_1053773651","dateCreated":"2018-10-04T13:13:33+0000","dateStarted":"2018-10-04T14:02:27+0000","dateFinished":"2018-10-04T14:02:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:209"},{"text":"%pyspark\n\n#input data dimension = (data samples, time steps, features)\ninputdata = numpy.zeros((len(inputstr), 1, len(uniquechars)), dtype = numpy.bool)\n#output data = (data samples, features)\nlabels = []\n\nprint('One to one mapping')\nfor i in range(0, len(inputstr) - 1):\n    inputdata[i, 0, lut[inputstr[i]]] = 1\n    labels.append(lut[inputstr[i + 1]])\n    #print(inputstr[i], '->', inputstr[i + 1])\n\n#next character of last one pointing to the [0]\nlabels.append(lut[inputstr[0]])\n\n#last character of input\nlastindex = len(inputstr) - 1;\ninputdata[lastindex, 0, lut[inputstr[lastindex]]] = 1\n\n#create one hot labels for classification\nonehotlabels = np_utils.to_categorical(labels)\n\n","user":"admin","dateUpdated":"2018-10-04T14:02:27+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"One to one mapping\n"}]},"apps":[],"jobName":"paragraph_1538658858363_91603783","id":"20181004-131418_233554814","dateCreated":"2018-10-04T13:14:18+0000","dateStarted":"2018-10-04T14:02:27+0000","dateFinished":"2018-10-04T14:02:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:210"},{"text":"%pyspark\n\nbatch_size = 1\n\n#input shape for first layer is (batch size, timesteps, features)\n#output in this case is number of unique characters\n\nmodel = Sequential()\nmodel.add(LSTM(units = 100, batch_input_shape=(batch_size, inputdata.shape[1], inputdata.shape[2]), stateful=True, return_sequences = True))\nmodel.add(LSTM(units = 50))\nmodel.add(Dense(units = onehotlabels.shape[1], activation = 'softmax'))\nmodel.compile(optimizer = 'rmsprop', loss = 'categorical_crossentropy', metrics = ['accuracy'])\n\n\nfor i in range(300):\n    #keep the state of the network\n    model.fit(inputdata, onehotlabels, epochs = epoch, batch_size = batch_size, verbose = 2, shuffle = False)\n    model.reset_states()\n    \n    if((i % 10) == 0):\n        print('Training #%d' % i)\n        callBack()\n\n\n#final prediction string\ncallBack()","user":"admin","dateUpdated":"2018-10-04T14:02:28+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"msg":[{"data":"","type":"TEXT"}]},"apps":[],"jobName":"paragraph_1538658926754_-1495025704","id":"20181004-131526_2038277892","dateCreated":"2018-10-04T13:15:26+0000","dateStarted":"2018-10-04T14:02:28+0000","dateFinished":"2018-10-04T13:53:41+0000","status":"RUNNING","progressUpdateIntervalMs":500,"$$hashKey":"object:211","errorMessage":""},{"title":"Python model saving.","text":"%pyspark\n\nmodel_id = skilContext.addModelToExperiment(z, model, \"Stateful LSTM for Sentence Prediction\")\n#skilContext.addEvaluationToModel(z, model_id, model, inputdata, onehotlabels, \"Stateful LSTM \" + str(epochs) + \" epochs\")\n","user":"admin","dateUpdated":"2018-10-04T14:02:27+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python","editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1538658435459_-1251384416","id":"20181004-130715_372883443","dateCreated":"2018-10-04T13:07:15+0000","dateStarted":"2018-10-04T14:02:28+0000","dateFinished":"2018-10-04T13:53:42+0000","status":"PENDING","progressUpdateIntervalMs":500,"$$hashKey":"object:212","errorMessage":""},{"text":"%pyspark\n","user":"admin","dateUpdated":"2018-10-04T13:52:31+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python","editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1538658435459_-1251384416","id":"20181004-130715_1258137860","dateCreated":"2018-10-04T13:07:15+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:213"}],"name":"/statefulLSTM","id":"2DTF2GHU6","angularObjects":{"2DTP2JXUS:existing_process":[],"2DUPJHYBA:existing_process":[],"2DSC1ECKJ:existing_process":[],"2DU54HT6Q:existing_process":[],"2DQXPW21D:existing_process":[],"2DTJFP6WC:existing_process":[],"2DTCCZ9KY:existing_process":[],"2DSTVCV4W:existing_process":[],"2DSSMX5HZ:existing_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}